<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Phantom detect</title>
  <style>
    body { font-family: Arial, sans-serif; text-align:center; margin-top:80px; color:#073b07; }
    button { padding:10px 14px; border-radius:8px; background:#00b37e; color:white; border:none; cursor:pointer; }
  </style>
</head>
<body>
  <h2>Phantom Wallet — detekcija</h2>
  <p id="info">Traženje Phantom ekstenzije...</p>
  <div id="controls" style="display:none;">
    <button id="connectBtn">Connect Phantom</button>
    <p id="status"></p>
  </div>
  <p id="help" style="margin-top:18px;"></p>

<script>
(async function() {
  const info = document.getElementById('info');
  const controls = document.getElementById('controls');
  const connectBtn = document.getElementById('connectBtn');
  const status = document.getElementById('status');
  const help = document.getElementById('help');

  function waitForProvider(timeoutMs = 5000, intervalMs = 200) {
    return new Promise((resolve) => {
      const start = Date.now();
      const iv = setInterval(() => {
        if (window.solana && window.solana.isPhantom) {
          clearInterval(iv);
          resolve(window.solana);
        } else if (Date.now() - start > timeoutMs) {
          clearInterval(iv);
          resolve(null);
        }
      }, intervalMs);
    });
  }

  const provider = await waitForProvider(5000);
  if (!provider) {
    info.textContent = 'Phantom nije pronađen u ovom tabu.';
    help.innerHTML = `
      <b>Mogući razlozi:</b>
      <ul style="display:inline-block; text-align:left; margin-top:8px;">
        <li>Otvorio/la si fajl direktno (file://) — koristi <code>http://localhost</code> ili HTTPS.</li>
        <li>Phantom nije instaliran ili nije omogućen za ovaj sajt.</li>
        <li>Stranica je otvorena pre nego što se ekstenzija inicijalizovala — osveži stranicu.</li>
      </ul>
      <div style="margin-top:8px;">
        <a href="https://phantom.app" target="_blank">Instaliraj Phantom</a>
      </div>
    `;
    return;
  }

  info.textContent = 'Phantom pronađen ✅';
  controls.style.display = 'block';

  connectBtn.onclick = async () => {
    status.textContent = 'Čekam permisiju...';
    try {
      const res = await window.solana.connect();
      status.innerHTML = `Povezano: <b>${res.publicKey.toString()}</b>`;
    } catch (err) {
      status.textContent = 'Greška ili otkazano: ' + (err.message || err.toString());
    }
  };
})();
</script>
</body>
</html>

